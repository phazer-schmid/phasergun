<div class="dashboard-container">
  <!-- Sidebar -->
  <aside class="dashboard-sidebar">
    <!-- Logo/Branding -->
    <div class="sidebar-header">
      <div class="app-logo">
        <div class="logo-icon">M</div>
        <div class="logo-content">
          <span class="logo-text">MedDev Pro</span>
          <span class="logo-subtitle">Regulatory Control</span>
        </div>
      </div>
    </div>

    <!-- Navigation -->
    <nav class="sidebar-nav">
      <div class="nav-section">
        <!-- Entire Project -->
        <div 
          class="nav-item"
          [class.nav-item-active]="currentView === 'project'"
          (click)="onEntireProjectClick()">
          <span class="nav-icon">üìÅ</span>
          <span class="nav-label">Entire Project</span>
        </div>

        <!-- Phase Items -->
        <div class="nav-item-container">
          <div 
            class="nav-item"
            [class.nav-item-active]="selectedPhaseId === 1"
            (click)="onPhaseClick(1)">
            <span class="nav-icon-number">1</span>
            <span class="nav-label">Phase 1: Planning</span>
          </div>
          <div *ngIf="project?.targetDates?.phase1" class="phase-deadline">
            Deadline: {{ formatDate(project!.targetDates!.phase1!) }}
          </div>
        </div>

        <div class="nav-item-container">
          <div 
            class="nav-item"
            [class.nav-item-active]="selectedPhaseId === 2"
            (click)="onPhaseClick(2)">
            <span class="nav-icon-number">2</span>
            <span class="nav-label">Phase 2: Design</span>
          </div>
          <div *ngIf="project?.targetDates?.phase2" class="phase-deadline">
            Deadline: {{ formatDate(project!.targetDates!.phase2!) }}
          </div>
        </div>

        <div class="nav-item-container">
          <div 
            class="nav-item"
            [class.nav-item-active]="selectedPhaseId === 3"
            (click)="onPhaseClick(3)">
            <span class="nav-icon-number">3</span>
            <span class="nav-label">Phase 3: Development</span>
          </div>
          <div *ngIf="project?.targetDates?.phase3" class="phase-deadline">
            Deadline: {{ formatDate(project!.targetDates!.phase3!) }}
          </div>
        </div>

        <div class="nav-item-container">
          <div 
            class="nav-item"
            [class.nav-item-active]="selectedPhaseId === 4"
            (click)="onPhaseClick(4)">
            <span class="nav-icon-number">4</span>
            <span class="nav-label">Phase 4: Testing</span>
          </div>
          <div *ngIf="project?.targetDates?.phase4" class="phase-deadline">
            Deadline: {{ formatDate(project!.targetDates!.phase4!) }}
          </div>
        </div>

        <!-- Regulatory Submission -->
        <div class="nav-item">
          <span class="nav-icon">‚úì</span>
          <span class="nav-label">Regulatory Submission</span>
        </div>
      </div>
    </nav>

    <!-- Sidebar Footer -->
    <div class="sidebar-footer">
      <div class="footer-text">¬© 2025 MedDev Pro</div>
      <div class="footer-version">v1.0.0 - HIPAA Compliant</div>
    </div>
  </aside>

  <!-- Main Content -->
  <main class="dashboard-main">
    <!-- Header -->
    <div class="dashboard-header">
      <div class="header-actions">
        <button class="btn-text" (click)="backToProjects()">‚Üê Back to Projects</button>
        <button class="btn-text" (click)="editProject()">‚úé Edit Project</button>
      </div>
      <div class="header-title-row">
        <h1 class="page-title">{{ currentViewTitle }}</h1>
        <button 
          class="btn-refresh"
          [disabled]="isScanning"
          (click)="scanDhfDocuments()">
          <span *ngIf="!isScanning">üîÑ Scan Documents</span>
          <span *ngIf="isScanning">‚è≥ Scanning...</span>
        </button>
      </div>
    </div>

    <!-- Stats Cards Row -->
    <div class="stats-row">
      <!-- Project Completeness Card -->
      <div class="card stats-card">
        <div class="stats-header">
          <div class="stats-label">Project Completeness</div>
          <div class="stats-value-large">57%</div>
        </div>
        <div class="progress-bar">
          <div class="progress-fill progress-gradient" style="width: 57%"></div>
        </div>
        <div class="stats-meta">24 of 42 documents submitted</div>
      </div>

      <!-- Document Quality Risk Card -->
      <div class="card stats-card stats-card-risk">
        <div class="stats-header">
          <div class="stats-label-row">
            <span class="stats-label">Document Quality Risk</span>
            <span class="badge badge-medium">MEDIUM</span>
          </div>
        </div>
        <div class="stats-value-row">
          <span class="stats-value-large">68</span>
          <span class="stats-suffix">/100 quality score</span>
        </div>
        <div class="stats-meta">3 issues detected in submitted documents</div>
      </div>
    </div>

    <!-- Main Content Row -->
    <div class="dashboard-grid">
      <!-- DHF Document Checklist -->
      <div class="card checklist-card">
        <div class="section-header">
          <h2 class="section-title">DHF Document Checklist</h2>
          <span class="section-meta">{{ getCompletedCount() }}/{{ dhfFiles.length }}</span>
        </div>

        <div class="checklist-content">
          <!-- DHF File Item -->
          <div *ngFor="let dhfFile of dhfFiles" class="dhf-file-item">
            <!-- DHF File Header -->
            <div class="dhf-file-header">
              <input 
                type="checkbox" 
                [checked]="dhfFile.status === 'complete'" 
                disabled 
                class="checkbox">
              
              <div class="dhf-file-info">
                <div class="dhf-file-title-row">
                  <div class="dhf-file-name" [innerHTML]="dhfFile.name"></div>
                  <!-- Status Badge - Right aligned -->
                  <span 
                    *ngIf="dhfFile.status === 'missing'" 
                    class="badge badge-orange">NOT STARTED</span>
                  <span 
                    *ngIf="dhfFile.status === 'in_progress'" 
                    class="badge badge-yellow">IN PROGRESS</span>
                </div>
                
                <!-- Document Reference below -->
                <div class="dhf-reference" [innerHTML]="formatDocumentReference(dhfFile.documentReference)"></div>
              </div>
            </div>

            <!-- Documents under DHF File -->
            <div *ngIf="dhfFile.documents && dhfFile.documents.length > 0" 
                 class="dhf-documents">
              <div *ngFor="let doc of dhfFile.documents" class="dhf-document-item">
                <span class="document-bullet">‚Ä¢</span>
                <div class="document-info">
                  <span class="document-name">{{ doc.name }}</span>
                  <span *ngIf="hasIssues(doc)" class="issue-icon" 
                        title="Issues detected">‚ö†Ô∏è</span>
                  <span *ngIf="doc.date" class="document-meta">
                    {{ doc.date }} ‚Ä¢ {{ doc.reviewer }}
                  </span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- AI Analysis Panel -->
      <div class="card analysis-card">
        <div class="section-header">
          <h2 class="section-title">AI Analysis & Narrative</h2>
        </div>

        <div class="analysis-content">
          <div *ngIf="scanError" class="analysis-error">
            <p><strong>Scan Error:</strong> {{ scanError }}</p>
          </div>

          <div *ngIf="!analysisResult && !isScanning && !scanError" class="analysis-empty">
            <p>No documents scanned yet. Click "Scan Documents" to analyze your project folder using AI-powered classification.</p>
          </div>

          <div *ngIf="isScanning" class="analysis-loading">
            <p>ü§ñ Scanning project folder and classifying documents using Claude AI...</p>
            <p class="scan-details">This may take a minute depending on the number of documents.</p>
          </div>

          <div *ngIf="analysisResult?.status === 'complete'" class="analysis-narrative">
            <h3 class="narrative-title">Project Status & AI Recommendations</h3>
            
            <div class="narrative-text">
              <p>Your medical device project is progressing well with 57% document completion rate. The quality score of 68/100 indicates moderate risk in submitted documents. Key areas requiring attention: Shelf Life Testing shows critical gaps, and Sterilization Validation documentation needs strengthening. Current trajectory suggests Phase 4 completion within 8 weeks if risk mitigation actions are implemented immediately.</p>
            </div>

            <!-- Show detailed report if available -->
            <div *ngIf="analysisResult!.detailedReport" class="narrative-details">
              {{ analysisResult!.detailedReport }}
            </div>

            <!-- Gaps Section (if available) -->
            <div *ngIf="analysisResult!.gaps && analysisResult!.gaps.length > 0" class="analysis-section">
              <h4 class="analysis-section-title">Identified Gaps</h4>
              <div *ngFor="let gap of analysisResult!.gaps" class="analysis-item">
                <span class="badge" [ngClass]="'badge-' + gap.severity">{{ gap.severity }}</span>
                <div class="analysis-item-text">
                  <strong>{{ gap.type }}:</strong> {{ gap.description }}
                </div>
              </div>
            </div>

            <!-- Risks Section (if available) -->
            <div *ngIf="analysisResult!.risks && analysisResult!.risks.length > 0" class="analysis-section">
              <h4 class="analysis-section-title">Risk Factors</h4>
              <div *ngFor="let risk of analysisResult!.risks" class="analysis-item">
                <span class="badge" [ngClass]="'badge-' + risk.severity">{{ risk.severity }}</span>
                <div class="analysis-item-text">
                  <strong>{{ risk.category }}:</strong> {{ risk.description }}
                </div>
              </div>
            </div>
          </div>

          <div *ngIf="analysisResult?.status === 'error'" class="analysis-error">
            <p><strong>Error:</strong> {{ analysisResult!.message }}</p>
            <p class="error-details">{{ analysisResult!.detailedReport }}</p>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>
